<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8"/>
  <title>Procesando pago ‚Ä¢ YourGains AI</title>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="min-h-screen flex items-center justify-center bg-neutral-950 text-white">
  <div class="text-center">
    <h1 class="text-2xl font-bold mb-4">Estamos preparando tu pago...</h1>
    <p class="text-neutral-400">Un momento mientras te redirigimos a Stripe.</p>
  </div>

  <script type="module">
    import { API_BASE } from "./config.js";
    import { checkAuthOrRedirect, getAuthHeaders } from "./auth.js";
    
    // Verificar autenticaci√≥n
    if (!checkAuthOrRedirect()) {
      return;
    }

    async function iniciarPago() {
      // ‚úÖ Sacamos el price_id de la URL (ej: pago.html?price_id=...)
      const params = new URLSearchParams(window.location.search);
      const price_id = params.get("price_id");

      if (!price_id) {
        alert("Error: falta el plan seleccionado.");
        window.location.href = "./tarifas.html";
        return;
      }

      try {
        // ‚úÖ Llamamos a tu backend FastAPI
        const headers = getAuthHeaders();
        if (!headers) return;
        
        const response = await fetch(`${API_BASE}/create-checkout-session`, {
          method: "POST",
          headers: headers,
          body: JSON.stringify({ price_id })
        });

        const data = await response.json();
        if (data.url) {
          window.location.href = data.url; // üîÅ Redirige a Stripe Checkout
        } else {
          throw new Error(data.detail || "Error inesperado en backend.");
        }
      } catch (err) {
        console.error(err);
        alert("Hubo un error al iniciar el pago.");
        window.location.href = "./tarifas.html";
      }
    }

    iniciarPago();
  </script>
</body>
</html>
