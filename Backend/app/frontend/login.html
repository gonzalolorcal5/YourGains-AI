<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Inicia sesi√≥n ‚Ä¢ YourGains AI</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
  <style>
    body {
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
      background: linear-gradient(135deg, #0a0a0a 0%, #1a1a1a 100%);
    }
    .gradient-bg {
      background: linear-gradient(135deg, rgba(132, 204, 22, 0.35) 0%, rgba(101, 163, 13, 0.25) 15%, rgba(74, 222, 128, 0.15) 30%, rgba(10, 10, 10, 0.9) 60%, rgba(0, 0, 0, 1) 100%);
      border: 1px solid rgba(132, 204, 22, 0.4);
    }
    .glow-effect {
      box-shadow: 0 0 40px rgba(132, 204, 22, 0.4), 0 0 80px rgba(132, 204, 22, 0.25), 0 0 120px rgba(132, 204, 22, 0.15), inset 0 0 60px rgba(132, 204, 22, 0.1);
    }
  </style>
</head>
<body class="min-h-screen text-white flex items-center justify-center relative overflow-hidden">
  <!-- Background decorative elements -->
  <div class="absolute inset-0 overflow-hidden pointer-events-none">
    <div class="absolute top-20 left-10 w-72 h-72 bg-lime-400/5 rounded-full blur-3xl"></div>
    <div class="absolute bottom-20 right-10 w-96 h-96 bg-lime-400/5 rounded-full blur-3xl"></div>
  </div>
  
  <div class="w-full max-w-md p-8 relative z-10">
    <div class="gradient-bg rounded-2xl shadow-2xl glow-effect backdrop-blur-sm">
      <div class="p-8">
        <!-- Logo and Title -->
        <div class="text-center mb-8">
          <div class="flex items-center justify-center gap-3 mb-2">
            <svg viewBox="0 0 800 800" width="40" height="40" xmlns="http://www.w3.org/2000/svg">
              <path transform="translate(237)" d="m0 0h19l10 5 8 6 4 4 4 8v5h1v10h234v-10l1-1 1-6 5-9 5-3 3-5 5-1 7-3h19l12 6 7 7h2l2 5 3 13v38l-2 20-3 15v8l-2 3-1 5h-2l-6 15-2 6-1 2-1 4-9 15-5 7-2 1-1 3-2 1-2 4-2 1-2 4-4 2-2 3-2 4-7 7-4 1-8 8-10 8-1 3-4 1-5 1-20-12-24-12-26-10-4-1v-2l10-4 14-8 10-7 1-1-91-1-16-10-13-11-10-9-6-4-1-4-4-2v-5l1-2 186-1 1-6 6-14 3-10 2-1h-232l2 1 2 6v7l4 5 9 17 5 7 1 3 3 2 1 4 4 2 2 5 10 10 17 13 14 9 23 12 21 8 26 8 22 9 22 11 8 5 5 1v2l12 8 12 9 4 1 3 5 4 1 3 5 15 15 4 2 1 4 5 3 1 3 5 5 7 10 7 11 8 16 1 8 6 18h2l1 7-1 1 3 17 1 14v12l-2 21-2 11 1 4-2 3-2 4-6 17v5l-10 19-12 18-5 5-2 4-4 2-2 5-5 3-15 15-2 4-4 1-15 12-5-2-23-13-23-11-24-9 1-3 19-10 15-10-94-1-14-9-14-11-15-15-4-2-1-4h-2l2-5h184l2-5h2l2-9h2l5-15h-229l1 7 2 1 1 7h2l2 4v5h2l6 10 1 3 5 5 1 3 3 2 1 4 5 3 7 7 2 4 8 6 3 1 2 4 17 11 23 12 21 8 36 12 20 9 21 11 21 14 14 11 11 10 4 1 3 5 4 2 3 3 1 4 4 3 3 2 1 4 3 1 1 3 2 1 1 3 4 4 10 16 1 6 3 1 3 9 2 7h2l1 8 2 4 2 2v8l3 14 2 21v38l-2 9-2 7-2 2-7 6-8 5-5 2h-18l-10-4-8-7-3-1-5-9-1-7h-1v-10h-234v10l-1 1-1 6-5 9-5 3-8 6-8 3h-18l-12-6-7-7h-2l-2-5-3-13v-38l2-21 3-14v-8l3-3 2-8 1-3 2-2 5-15h2l2-8 12-18 2-1 1-3 2-1 1-3 3-1 1-4 5-3 2-3 2-4 10-10 4-1 11-10 11-8 5 1 16 10 26 13 24 9 5 3-3 2-17 9-12 8-2 2 91 1 16 10 13 11 10 9 6 4 1 4 4 2v5l-1 2-184 1-7 15-5 15-2 1h232l-2-1-5-15-8-17-7-10-1-3-3-2-1-4-4-2-2-5-10-10-17-13-14-9-23-12-21-8-29-9-23-10-25-13-6-2v-2l-12-8-13-10-7-5-4-2-2-4-16-16-4-2-2-5-3-1-1-4-3-1-1-3-5-5-12-20-6-12v-5h-2l-1-8-6-20-3-18-1-13v-14l2-20 4-19 5-15v-5h2l1-7 9-17 9-14 6-8 3-1 1-4 3-1 1-4 6-4 16-16 2-4 4-1 3-5 4-1 8-6 5 2 23 13 23 11 24 9-1 3-19 10-15 10 98 1 1 3 13 9 11 9 14 14 4 2 1 4h2l-2 5h-184l-2 5h-2l-2 9h-2l-5 15h230l-5-15h-2l-2-9h-2l-6-10-1-3-5-5-1-3-3-2-1-4-5-3-7-7-2-4-3-2-3-1-1-3-4-1-2-4-17-11-23-12-21-8-36-12-20-9-21-11-21-14-14-11-12-11-5-2-8-8-1-4-4-3-3-2-1-4-3-1-1-3-2-1-1-3-4-4-10-16-1-6-3-1-2-9-3-7h-2l-1-8-2-4-2-2v-8l-3-14-2-21v-38l2-9 2-7 2-2 7-6 8-5zm296 5m-259 8m251 0m-250 1m249 0m-308 1m367 0m-307 1m247 0m-308 1m62 0m245 0m62 0m-306 2 1 2zm243 0 1 2zm-242 2 1 2zm241 0 1 2zm-240 3 1 3zm239 0 1 3zm-238 15v1h238v-1zm3 48m231 0m-230 1 1 3zm229 0 1 3zm-228 4 1 3zm227 0 1 2zm-1 3 1 2zm-1 3 1 2zm-1 2 1 2zm-1 3 1 2zm-219 1m1 1 1 2zm217 1m-291 2 1 3zm75 0m215 0m75 0 1 3zm-289 2m213 0m-212 2m211 0m-210 2m1 1m284 0 1 2zm-283 2m1 2m1 1m19 1m-18 1m19 0m-18 1m1 2m1 1m20 1m-19 1m20 0m-17 4m1 1m-80 5m84 0m-83 1 1 2zm84 0m1 1m253 5m-334 2m333 0m-332 2m331 0m-330 2m329 0m-328 1m327 0m-326 2m325 0m-324 2m323 0m-322 1m321 0m-320 2m319 0m-318 1m317 0m-316 2m315 0m-314 1m216 0m97 0m-312 2m311 0m-310 1m309 0m-306 4m303 0m-300 4m297 0m-293 5m289 0m-288 1m287 0m-280 8m273 0m-272 1m271 0m-270 1m269 0m-268 2m266 0m-264 2m263 0m-261 2m259 0m-25 21m-22 12m-193 20m221 0m-222 1m223 0m-229 5m235 0m-236 1m237 0m-259 22m281 0m-282 1m-1 1m-4 5m293 0m3 4m-300 1m301 0m-302 1m303 0m1 2m-306 1m307 0m-308 1m309 0m-310 2m311 0m-312 1m313 0m-314 1 1 2zm315 1m-316 1m195 0m122 0m-94 1m-224 1m319 0m-320 1m321 0m-322 2m231 0m92 0m-324 1m325 0m-326 2m327 0m-328 2m329 0m-330 1 1 2zm331 1m-332 1m244 0m89 0m-87 1m-247 1m248 0m87 0m-86 1m-250 1m251 0m86 0m-338 2m253 0m86 0m-340 2m341 0m-342 2m343 0m-344 2m262 0m83 0m-346 1 1 2zm264 0m83 1m-348 2 1 2zm349 0 1 2zm-81 1m1 1m1 2m1 1m-18 2m1 1m20 2m1 1m1 2m1 1m-206 2m207 0m-208 1m209 0m-210 2m211 0m-288 2 1 3zm76 0m213 0m76 0 1 3zm-290 2m215 0m-216 2 1 2zm217 0 1 2zm-218 2m219 0m-220 3 1 2zm221 0 1 2zm-222 2 1 2zm223 0 1 2zm-224 3 1 2zm225 0 1 2zm-226 2 1 3zm227 0 1 3zm-228 4 1 3zm229 0 1 3zm-230 3m231 0m-234 48v1h238v-1zm-1 13 1 3zm239 0 1 3zm-240 4 1 2zm241 0 1 2zm-242 2 1 2zm243 0 1 2z" fill="#84CC16"/>
            </svg>
            <div class="text-3xl font-bold tracking-tight">YourGains <span class="text-lime-400">AI</span></div>
          </div>
          <p class="text-neutral-400 text-sm mt-4">Tu entrenador personal con inteligencia artificial</p>
        </div>

        <div class="space-y-6">
          <!-- Checkbox de t√©rminos y condiciones -->
          <div class="bg-neutral-800/30 rounded-xl p-4 border border-neutral-700/50">
            <div class="flex items-start gap-3">
              <input 
                type="checkbox" 
                id="acceptTerms" 
                class="mt-0.5 w-5 h-5 rounded bg-neutral-800 border-neutral-600 text-lime-400 focus:ring-2 focus:ring-lime-400 focus:ring-offset-0 cursor-pointer transition-all hover:border-lime-400/50"
              />
              <label for="acceptTerms" class="text-sm text-neutral-300 cursor-pointer leading-relaxed">
                He le√≠do y acepto los 
                <button type="button" id="termsLink" class="text-lime-400 hover:text-lime-300 hover:underline transition-colors font-medium">T√©rminos y Condiciones</button> 
                y la 
                <button type="button" id="privacyLink" class="text-lime-400 hover:text-lime-300 hover:underline transition-colors font-medium">Pol√≠tica de Privacidad</button>
              </label>
            </div>
            <p id="termsError" class="text-sm text-red-400 mt-2 hidden flex items-center gap-1">
              <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z" clip-rule="evenodd"/>
              </svg>
              Debe aceptar los t√©rminos y condiciones para poder iniciar sesi√≥n
            </p>
          </div>

          <!-- Google Login Button -->
          <button
            id="googleLogin"
            class="w-full bg-white text-gray-900 font-semibold rounded-xl py-4 hover:bg-gray-50 transition-all duration-200 flex items-center justify-center gap-3 shadow-lg hover:shadow-xl transform hover:-translate-y-0.5 border border-gray-200"
            type="button"
          >
            <svg class="w-5 h-5" viewBox="0 0 24 24" aria-hidden="true">
              <path fill="#4285F4" d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"/>
              <path fill="#34A853" d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"/>
              <path fill="#FBBC05" d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"/>
              <path fill="#EA4335" d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"/>
            </svg>
            <span class="text-[15px]">Continuar con Google</span>
          </button>

          <p id="msg" class="text-center text-sm min-h-5"></p>
          
          <div id="logoutSection" class="text-center pt-4 border-t border-neutral-800" style="display: none;">
            <p class="text-neutral-400 text-sm mb-2">Sesi√≥n activa</p>
            <button id="logoutBtn" class="text-sm text-red-400 hover:text-red-300 underline transition-colors">
              Cerrar sesi√≥n
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script type="module">
    console.log("üü¢ Script login.html cargando...");

    // Capturar token de OAuth callback (si existe en URL)
    const urlParams = new URLSearchParams(window.location.search);
    const oauthToken = urlParams.get("token");
    const onboardingFromUrl = urlParams.get("onboarding");
    
    if (oauthToken) {
      console.log("üü¢ Token OAuth recibido, procesando...");
      try {
        const payloadBase64 = oauthToken.split(".")[1];
        const payloadJson = atob(payloadBase64.replace(/-/g, "+").replace(/_/g, "/"));
        const payload = JSON.parse(decodeURIComponent(escape(payloadJson)));
        
        // Guardar token y datos b√°sicos del usuario
        localStorage.setItem("accessToken", oauthToken);
        if (payload.email) {
          localStorage.setItem("email", payload.email);
        }
        if (payload.user_id || payload.sub) {
          const uid = String(payload.user_id || payload.sub);
          localStorage.setItem("user_id", uid);
        }
        localStorage.setItem("loginTimestamp", Date.now().toString());
        localStorage.setItem("onboarding_completed", onboardingFromUrl === "true" ? "true" : "false");
      } catch (e) {
        console.error("‚ùå Error procesando token OAuth", e);
      }
      
      // Limpiar URL (quitar query params)
      window.history.replaceState({}, document.title, "/login.html");
      
      // Redirigir seg√∫n onboarding
      if (onboardingFromUrl === "true") {
        window.location.href = "./dashboard.html";
      } else {
        window.location.href = "./onboarding.html";
      }
    }

    import { logout } from "./auth.js";
    console.log("üü¢ Auth.js importado correctamente");

    const msgEl = document.getElementById("msg");
    const logoutSection = document.getElementById("logoutSection");
    const logoutBtn = document.getElementById("logoutBtn");

    // Funci√≥n para mostrar error de t√©rminos
    function showTermsError() {
      const acceptTerms = document.getElementById("acceptTerms");
      const termsError = document.getElementById("termsError");
      
      // Poner la casilla roja
      acceptTerms.classList.add("border-red-500", "ring-2", "ring-red-500");
      acceptTerms.classList.remove("border-neutral-700");
      
      // Mostrar mensaje de error
      termsError.classList.remove("hidden");
      
      // Limpiar otros mensajes
      msgEl.textContent = "";
    }

    // Funci√≥n para limpiar error de t√©rminos
    function clearTermsError() {
      const acceptTerms = document.getElementById("acceptTerms");
      const termsError = document.getElementById("termsError");
      
      // Quitar el estilo rojo
      acceptTerms.classList.remove("border-red-500", "ring-2", "ring-red-500");
      acceptTerms.classList.add("border-neutral-700");
      
      // Ocultar mensaje de error
      termsError.classList.add("hidden");
    }

    // Limpiar error cuando el usuario marca la casilla
    document.getElementById("acceptTerms").addEventListener("change", (e) => {
      if (e.target.checked) {
        clearTermsError();
      }
    });


    // Manejar logout
    logoutBtn.addEventListener("click", (e) => {
      e.preventDefault();
      logout();
    });

    // Verificar si ya hay sesi√≥n activa
    const token = localStorage.getItem("accessToken");
    const email = localStorage.getItem("email");
    if (token && email) {
      logoutSection.style.display = "block";
      msgEl.textContent = `Sesi√≥n activa: ${email}`;
      msgEl.className = "text-center text-sm text-green-400 min-h-5";
    }


    // Google OAuth Login
    const googleLoginBtn = document.getElementById("googleLogin");
    if (googleLoginBtn) {
      googleLoginBtn.addEventListener("click", (e) => {
        e.preventDefault();
        const acceptTerms = document.getElementById("acceptTerms");
        
        if (!acceptTerms.checked) {
          showTermsError();
          return;
        }
        
        // Limpiar error si todo est√° bien
        clearTermsError();
        
        window.location.href = "/auth/google/login";
      });
    }

    // Overlays para t√©rminos y privacidad
    const termsLink = document.getElementById("termsLink");
    const privacyLink = document.getElementById("privacyLink");
    
    // Crear overlay para t√©rminos
    function createTermsOverlay() {
      const overlay = document.createElement('div');
      overlay.id = 'termsOverlay';
      overlay.className = 'fixed inset-0 bg-black/80 backdrop-blur-sm z-50 flex items-center justify-center p-4';
      overlay.style.display = 'none';
      
      overlay.innerHTML = `
        <div class="bg-neutral-900 rounded-2xl shadow-2xl max-w-4xl w-full max-h-[90vh] overflow-hidden flex flex-col border border-neutral-800">
          <div class="flex-shrink-0 bg-neutral-800/50 border-b border-neutral-700 p-4 flex items-center justify-between">
            <h2 class="text-xl font-bold text-white">T√©rminos y Condiciones</h2>
            <button onclick="closeTermsOverlay()" class="text-neutral-400 hover:text-white text-2xl font-bold w-8 h-8 flex items-center justify-center rounded hover:bg-neutral-700 transition">√ó</button>
          </div>
          <div class="flex-1 overflow-y-auto p-6">
            <iframe src="./terms.html" class="w-full h-full border-0" style="min-height: 600px;"></iframe>
          </div>
        </div>
      `;
      
      document.body.appendChild(overlay);
      return overlay;
    }
    
    // Crear overlay para privacidad
    function createPrivacyOverlay() {
      const overlay = document.createElement('div');
      overlay.id = 'privacyOverlay';
      overlay.className = 'fixed inset-0 bg-black/80 backdrop-blur-sm z-50 flex items-center justify-center p-4';
      overlay.style.display = 'none';
      
      overlay.innerHTML = `
        <div class="bg-neutral-900 rounded-2xl shadow-2xl max-w-4xl w-full max-h-[90vh] overflow-hidden flex flex-col border border-neutral-800">
          <div class="flex-shrink-0 bg-neutral-800/50 border-b border-neutral-700 p-4 flex items-center justify-between">
            <h2 class="text-xl font-bold text-white">Pol√≠tica de Privacidad</h2>
            <button onclick="closePrivacyOverlay()" class="text-neutral-400 hover:text-white text-2xl font-bold w-8 h-8 flex items-center justify-center rounded hover:bg-neutral-700 transition">√ó</button>
          </div>
          <div class="flex-1 overflow-y-auto p-6">
            <iframe src="./privacy.html" class="w-full h-full border-0" style="min-height: 600px;"></iframe>
          </div>
        </div>
      `;
      
      document.body.appendChild(overlay);
      return overlay;
    }
    
    // Funciones globales para cerrar overlays
    window.closeTermsOverlay = function() {
      const overlay = document.getElementById('termsOverlay');
      if (overlay) overlay.style.display = 'none';
    };
    
    window.closePrivacyOverlay = function() {
      const overlay = document.getElementById('privacyOverlay');
      if (overlay) overlay.style.display = 'none';
    };
    
    // Cerrar al hacer clic fuera del contenido
    document.addEventListener('click', (e) => {
      const termsOverlay = document.getElementById('termsOverlay');
      const privacyOverlay = document.getElementById('privacyOverlay');
      
      if (termsOverlay && e.target === termsOverlay) {
        closeTermsOverlay();
      }
      if (privacyOverlay && e.target === privacyOverlay) {
        closePrivacyOverlay();
      }
    });
    
    // Inicializar overlays
    const termsOverlay = createTermsOverlay();
    const privacyOverlay = createPrivacyOverlay();
    
    if (termsLink) {
      termsLink.addEventListener("click", (e) => {
        e.preventDefault();
        termsOverlay.style.display = 'flex';
      });
    }
    
    if (privacyLink) {
      privacyLink.addEventListener("click", (e) => {
        e.preventDefault();
        privacyOverlay.style.display = 'flex';
      });
    }
  </script>
</body>
</html>
